'use strict';

angular.module('app', [
        //modules
        'app.templates',

        //pages
        'app.pages.catalog',
        'app.pages.book',

        //factories
        'app.api.factory',

        'ngMaterial',
        'ngResource',
        'ui.router'
    ])

.config(function($mdThemingProvider) {
      $mdThemingProvider.theme('default')
          .primaryPalette('cyan')
          .accentPalette('blue-grey');
    })

.config(function($stateProvider, $urlRouterProvider, $locationProvider) {
        $locationProvider.html5Mode(true);

        $stateProvider
            .state('404', {
                templateUrl: '404/404.html'
            });

        $urlRouterProvider.otherwise(function($injector, $location){
           var state = $injector.get('$state');
           state.go('404');
           return $location.path();
        });

    })

.run();
angular.module('app.api.factory', [])
    .factory('ApiFactory', function ($resource) {

        var apiPath = 'https://ds.aggregion.com/api';
        var _api = {
            catalog: $resource(apiPath + '/public/catalog',
                {},
                {
                    get: {method: 'GET', isArray: true}
                }
            ),
            book: $resource(apiPath + '/public/catalog/:bookId',
                {bookId: '@bookId'},
                {
                    get: {method: 'GET'}
                }
            )
        };

        var exports = {
            getCatalog: function () {
                return _api.catalog.get({}, function () {
                    //
                }, function (response) {
                    //
                }).$promise;
            },
            getBook: function (bookId) {
                return _api.book.get({bookId: bookId}, function () {
                    //
                }, function (response) {
                    //
                }).$promise;
            }
        };

        return exports;
    });
angular.module('app.pages.book', [])

    .config(function ($stateProvider) {

        $stateProvider
            .state('book', {
                url: '/book/:bookId',
                templateUrl: 'book/book.html',
                controller: 'BookPageCtrl',
                resolve: {
                    book: function ($stateParams, ApiFactory) {
                        return ApiFactory.getBook($stateParams.bookId);
                    }
                }
            });

    })

    .controller('BookPageCtrl', function ($scope, book) {

        $scope.book = book;

    });
angular.module('app.pages.catalog', ['ui.router'])

    .config(function ($stateProvider) {

        $stateProvider
            .state('catalog', {
                url: '/',
                templateUrl: 'catalog/catalog.html',
                controller: 'CatalogPageCtrl',
                resolve: {
                    books: function (ApiFactory) {
                        return ApiFactory.getCatalog();
                    }
                }
            });

    })

    .controller('CatalogPageCtrl', function ($scope, books) {

        $scope.books = books;

    });